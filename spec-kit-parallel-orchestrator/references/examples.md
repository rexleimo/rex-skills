# Spec Kit 并行编排示例

> 命令前缀兼容说明：`/speckit.*` 与 `/prompts:speckit.*` 视为同一类触发指令（后者常见于 Codex CLI）。

## 目录

1. 基础通用模板
2. 代码实现模板
3. 文档分析模板
4. 失败重试模板

## 1) 基础通用模板

```text
你现在处理的是 spec kit 工作流任务。

目标：{填写目标}
约束：{填写约束，如技术栈/时间/不可改动范围}

请按以下规则执行：
1) 将任务拆分为 3-6 个子任务并行执行（中等复杂度默认 3 个）。
2) 每个子任务必须定义：目标、输入、输出、边界、禁止修改范围。
3) 子任务间避免写冲突；如存在强依赖链，按依赖链串行。
4) 等待本轮全部子任务完成后，统一汇总。
5) 汇总输出必须包含：
   - 已完成事项
   - 未解决阻塞
   - 风险与影响范围
   - 下一轮计划（继续并行或转串行）

现在先输出“第 1 轮并行拆分方案（3-6项）”，再开始执行。
```

## 2) 代码实现模板

```text
请以 spec kit 模式完成以下代码任务：{填写任务}

代码库上下文：
- 语言/框架：{填写}
- 关键目录：{填写}
- 禁止改动：{填写}

执行要求：
1) 拆分 3-6 个 Sub Agent 并行任务（默认 3 个）：
   - A: 信息收集与影响面分析
   - B: 核心实现改动
   - C: 测试/校验与结果核对
   - 若复杂度高，再扩展 D/E/F（如文档、迁移脚本、回归风险分析）
2) 明确每个 Sub Agent 的文件边界，禁止同文件重叠写入。
3) 所有 Sub Agent 返回后统一汇总，给出最终补丁计划。
4) 若存在依赖链（如先改接口再改调用方），必须串行执行该链路。

先输出并行任务卡，再执行。
```

## 3) 文档分析模板

```text
请使用 spec kit 并行工作流分析以下内容：{填写文档/需求}

目标：输出可执行方案，并识别冲突与风险。

规则：
1) 拆分 3-6 个并行子任务，例如：
   - 需求拆解
   - 依赖与约束识别
   - 方案备选对比
   - 风险评估
   - 验收标准定义
2) 各子任务独立产出，格式统一。
3) 汇总时输出：
   - 结论摘要
   - 关键分歧与裁决
   - 最终推荐方案
   - 下一步行动清单（按优先级）

请先给出本轮 3-6 个子任务列表与边界说明。
```

## 4) 失败重试模板

```text
当前任务使用 spec kit 并行工作流，出现子任务失败。

失败上下文：
- 失败子任务：{任务名}
- 失败原因：{错误/阻塞}
- 受影响范围：{文件/模块/阶段}

请按以下恢复策略执行：
1) 保持已完成且无冲突的子任务结果，不回滚整轮。
2) 仅对失败子任务及其直接依赖节点做局部重排。
3) 若失败原因可消除，重新拆分为 1-3 个补救子任务并行执行；
   若属于强依赖或共享写入冲突，改为串行补救链。
4) 新一轮补救执行前，先输出风险控制：
   - 禁止修改范围
   - 回滚触发条件
   - 验证检查点
5) 补救完成后输出最终汇总：
   - 保留产出
   - 补救产出
   - 仍未解决问题
   - 建议下一步（继续并行 / 转串行 / 请求人工决策）

现在请先给出“局部重排方案”，再执行补救任务。
```
