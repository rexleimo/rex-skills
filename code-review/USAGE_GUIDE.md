# 通用代码审查 OpenSkill 使用与集成指南

**作者**: Manus AI
**版本**: 1.0.0
**日期**: 2026年1月31日

## 1. 简介

本文档详细介绍了通用代码审查（Code Review）OpenSkill 的设计理念、使用方法和集成策略。该 Skill 旨在提供一个跨平台、可定制且自动化的代码审查解决方案，其核心是受 Anthropic 的 `claude-code` 审查插件启发而设计的多代理（Multi-Agent）架构和置信度评分系统。通过将代码审查任务分解给多个具有不同专长的 AI 代理并行处理，并对发现的问题进行置信度评估，本 Skill 能够有效过滤误报，提供高质量、可操作的反馈。无论您是在 GitHub、GitLab 上管理拉取请求（Pull Request），还是在本地使用 Git，或是在 Codex、Cursor 等现代 AI 编程工具中工作，本 Skill 都能无缝集成，显著提升代码质量和开发效率。

## 2. 核心概念

为了充分利用此 Skill，理解其背后的两个核心概念至关重要：多代理架构和置信度评分系统。

### 2.1. 多代理审查架构

传统的自动化审查工具通常采用单一的、基于规则的分析模式。本 Skill 则创新性地采用多代理并行审查架构，模拟人类专家团队的协作模式。每个代理都专注于一个特定的审查维度，协同完成全面的代码审计。

| 代理角色 | 审查焦点 | 优先级 |
| :--- | :--- | :--- |
| **合规性代理 (x2)** | 检查代码是否遵循项目既定的编码规范和指南，例如 `CLAUDE.md` 或 `CONTRIBUTING.md` 中定义的规则。 | **高** |
| **Bug 检测代理** | 专注于在代码变更（Diff）中扫描明显的、高确定性的 Bug，如空指针、逻辑错误等。 | **关键** |
| **上下文分析代理** | 通过分析 Git 提交历史（`git blame`）和相关代码，发现可能由变更引入的、与上下文相关的深层次问题。 | **中** |

这种架构的优势在于其**冗余性和专业性**。例如，通过部署两个合规性代理，可以交叉验证结果，减少遗漏。同时，专门的 Bug 检测代理可以更深入地分析代码逻辑，而无需分心于风格问题。

### 2.2. 置信度评分系统

自动化工具的一大挑战是误报（False Positives）过多，这会干扰开发者的工作流程并降低工具的可信度。为了解决这个问题，本 Skill 引入了置信度评分系统。每个由代理发现的潜在问题都会被赋予一个 0 到 100 之间的分数，以量化其作为真实问题的可能性。

| 分数范围 | 置信度 | 建议操作 |
| :--- | :--- | :--- |
| 80 - 100 | **高度确信** | 标记为高优先级问题，应立即报告。 |
| 50 - 79 | **中等确信** | 可能需要人工审查以确认其有效性。 |
| 0 - 49 | **低度确信** | 大概率是误报，系统会自动过滤。 |

默认情况下，只有得分**大于等于 80** 的问题才会被报告。这一阈值可以在 Skill 配置中进行调整，以适应不同项目的需求。通过这种机制，Skill 能够将注意力集中在最重要的问题上，确保每一条反馈都有价值。

## 3. 快速入门

本 Skill 的使用非常灵活，以下是在不同场景下的快速入门指南。

### 3.1. 审查 GitHub 拉取请求 (PR)

当需要审查一个 GitHub PR 时，首先使用 `gh` 命令行工具获取 PR 的基本信息和代码变更。

```bash
# 获取 PR 的标题、描述等元数据
gh pr view <PR_NUMBER> --json number,title,body

# 获取 PR 的代码变更内容
gh pr diff <PR_NUMBER>
```

然后，将获取到的信息整合后，作为输入提供给 AI 编程工具，并指示其使用本 Skill 的审查工作流进行分析。

### 3.2. 审查本地代码变更

本 Skill 同样支持对本地的 Git 变更进行审查，无论是暂存区中的内容还是当前分支与主分支的差异。

```bash
# 审查已暂存（staged）的变更
git diff --cached

# 审查当前分支相对于 main 分支的所有变更
git diff main...HEAD
```

将 `git diff` 的输出内容直接提供给 AI 工具即可触发审查流程。

## 4. 集成指南

本 Skill 的设计目标是实现广泛的兼容性。以下是在不同平台和工具中集成和使用本 Skill 的详细指南。

### 4.1. 版本控制平台

**GitHub**: 与 GitHub 的集成主要通过其官方命令行工具 `gh` 实现。除了获取 PR 信息，还可以通过 `gh pr comment` 命令将审查结果直接发布到 PR 页面。详细的命令和 API 调用方法请参阅 Skill 包中的 `references/platforms.md` 文件。

**GitLab**: 与 GitLab 的集成方式类似，使用 `glab` 命令行工具。可以通过 `glab mr diff` 获取变更，并通过 `glab mr note` 发布评论。详细指南同样位于 `references/platforms.md`。

### 4.2. AI 编程工具

本 Skill 的核心是一套标准化的工作流和 Prompt 指令，可以轻松集成到任何支持自定义指令或系统提示的 AI 编程工具中。

**Claude Code**: 作为原生支持的平台，只需将本 Skill 添加为其插件即可通过 `/code-review` 命令直接调用。

**OpenAI Codex / ChatGPT**: 在“自定义指令”（Custom Instructions）或系统提示（System Prompt）中加入 `templates/review_prompt.md` 文件中定义的审查工作流和标准，即可让模型扮演审查专家的角色。

**Cursor**: 通过在项目根目录创建 `.cursorrules` 文件，可以将本 Skill 的审查标准（如何时标记、何时忽略）固化为 Cursor 的内置规则。这使得在 Cursor 中进行的每一次代码审查都能遵循统一标准。

**通用集成模式**: 对于任何其他 AI 工具，都可以使用 `templates/review_prompt.md` 中提供的通用 Prompt 模板。该模板完整定义了审查的每一步、评分标准和输出格式，只需将其与代码变更内容一同提交，即可获得高质量的审查结果。详细的集成说明请参阅 `references/ai-tools.md`。

## 5. 自定义与扩展

本 Skill 具有高度的可扩展性，您可以根据团队的具体需求进行定制。

- **自定义审查指南**: 您可以在项目中添加自定义的指南文件（如 `docs/STYLE_GUIDE.md`），Skill 会自动读取并将其作为合规性检查的依据。
- **调整评分阈值**: 如果默认的 80 分置信度阈值不符合您的要求，可以直接在 `scripts/score_issue.py` 脚本中进行修改。
- **扩展脚本功能**: Skill 附带的 Python 脚本（`analyze_diff.py`, `score_issue.py`, `format_review.py`）是完全开放的，您可以根据需要修改或扩展它们，以支持更复杂的分析或输出格式。

## 6. 结论

通用代码审查 OpenSkill 通过结合多代理架构、置信度评分和跨平台集成能力，为自动化代码审查提供了一个强大而灵活的解决方案。它不仅能够发现潜在的 Bug 和不合规代码，还能通过智能过滤机制减少噪音，使开发者能够专注于真正重要的问题。我们相信，将本 Skill 集成到您的开发工作流中，将极大地提升团队的代码质量和整体生产力。
